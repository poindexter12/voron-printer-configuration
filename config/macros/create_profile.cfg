[gcode_macro CREATE_PROFILE]
description: "Heats up, performs QGL, calibrates Z, fast bed mesh, and saves config. Requires PROFILE, BED_TEMP, HOTEND_TEMP."
gcode:
  {% if 'PROFILE' not in params %}
    RESPOND PREFIX="ERROR" MSG="Missing required parameter: PROFILE"
    ABORT
  {% endif %}
  {% if 'BED_TEMP' not in params %}
    RESPOND PREFIX="ERROR" MSG="Missing required parameter: BED_TEMP"
    ABORT
  {% endif %}
  {% if 'HOTEND_TEMP' not in params %}
    RESPOND PREFIX="ERROR" MSG="Missing required parameter: HOTEND_TEMP"
    ABORT
  {% endif %}

  {% set profile = params.PROFILE %}
  {% set bed_temp = params.BED_TEMP|float %}
  {% set hotend_temp = params.HOTEND_TEMP|float %}

  M117 Heating bed to {bed_temp}C and nozzle to {hotend_temp}C
  M140 S{bed_temp}
  M104 S{hotend_temp}
  M190 S{bed_temp}
  M109 S{hotend_temp}

  M117 Homing and leveling...
  G28
  QUAD_GANTRY_LEVEL
  G28 Z

  M117 Begin PROBE_CALIBRATE for {profile}
  PROBE_CALIBRATE

  M117 Run BED_MESH_CALIBRATE_FAST for {profile}
  BED_MESH_CALIBRATE_FAST PROFILE={profile}

  M117 Accept and SAVE_CONFIG after confirming Z offset